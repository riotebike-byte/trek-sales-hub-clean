<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trek Sales Hub - Ana Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #007AFF;
            --secondary-color: #5856D6;
            --success-color: #34C759;
            --warning-color: #FF9500;
            --danger-color: #FF3B30;
            --text-primary: #1D1D1F;
            --text-secondary: #86868B;
            --surface-primary: #FFFFFF;
            --surface-secondary: #F2F2F7;
            --surface-tertiary: #FAFAFA;
            --border-color: #E5E5EA;
            --shadow-light: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-medium: 0 4px 12px rgba(0, 0, 0, 0.15);
            --shadow-heavy: 0 8px 32px rgba(0, 0, 0, 0.2);
            --gradient-primary: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
            --gradient-success: linear-gradient(135deg, #34C759 0%, #30D158 100%);
            --gradient-warning: linear-gradient(135deg, #FF9500 0%, #FFCC02 100%);
        }

        /* Profit Filter Panel */
        .profit-filter-panel {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin: 20px auto 30px;
            border: 2px solid rgba(255, 215, 0, 0.2);
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.1);
            max-width: 1200px;
        }
        
        .profit-filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .profit-filter-title {
            font-size: 1.8em;
            font-weight: 700;
            color: #1D1D1F;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .profit-ranking-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .profit-category-card {
            background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,165,0,0.05));
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        
        .profit-category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(255, 215, 0, 0.2);
            background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,165,0,0.1));
        }
        
        .profit-rank {
            position: absolute;
            top: -12px;
            right: -12px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1em;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .profit-category-name {
            font-weight: 600;
            margin-bottom: 10px;
            color: #1D1D1F;
            font-size: 1.2em;
        }
        
        .profit-potential {
            font-size: 1.8em;
            font-weight: 700;
            color: #34C759;
            margin-bottom: 8px;
        }
        
        .profit-details {
            font-size: 0.9em;
            color: #86868B;
            line-height: 1.5;
        }
        
        .filter-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .filter-button {
            background: var(--surface-secondary);
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .filter-button:hover, .filter-button.active {
            background: var(--gradient-primary);
            border-color: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 122, 255, 0.3);
        }
        
        .update-agents-button {
            background: var(--gradient-success);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(52, 199, 89, 0.3);
            font-size: 1em;
        }
        
        .update-agents-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(52, 199, 89, 0.4);
        }

        /* Margin Analysis Modal */
        .margin-analysis-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 10000;
            display: none;
            overflow-y: auto;
        }
        
        .margin-modal-content {
            background: linear-gradient(135deg, #2E8B57 0%, #228B22 100%);
            margin: 2% auto;
            padding: 0;
            width: 95%;
            max-width: 1600px;
            border-radius: 20px;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            color: white;
        }
        
        .margin-modal-header {
            background: rgba(0, 0, 0, 0.2);
            padding: 25px 35px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .margin-modal-title {
            font-size: 2em;
            font-weight: 700;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .margin-modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5em;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .margin-modal-close:hover {
            background: rgba(255, 0, 0, 0.3);
            transform: scale(1.1);
        }
        
        .margin-tab-navigation {
            display: flex;
            background: rgba(0, 0, 0, 0.1);
            padding: 0;
            margin: 0;
        }
        
        .margin-tab-btn {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            padding: 20px 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            font-size: 1.1em;
            font-weight: 600;
            flex: 1;
        }
        
        .margin-tab-btn.active {
            color: white;
            background: rgba(255, 255, 255, 0.1);
            border-bottom-color: #32CD32;
        }
        
        .margin-tab-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            color: white;
        }
        
        .margin-tab-content {
            padding: 35px;
            min-height: 600px;
        }
        
        .margin-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }
        
        .margin-summary-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .margin-summary-value {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        
        .margin-summary-label {
            opacity: 0.9;
            font-size: 1em;
            font-weight: 500;
        }
        
        .margin-category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }
        
        .margin-category-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .margin-category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }
        
        .margin-category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .margin-category-name {
            font-size: 1.4em;
            font-weight: 700;
        }
        
        .margin-percentage {
            font-size: 1.6em;
            font-weight: 700;
            padding: 8px 16px;
            border-radius: 25px;
        }
        
        .margin-excellent { background: #32CD32; color: #000; }
        .margin-good { background: #98FB98; color: #000; }
        .margin-warning { background: #FFD93D; color: #000; }
        .margin-critical { background: #FF6B6B; color: #fff; }
        
        .margin-metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .margin-metric-box {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .margin-metric-value {
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .margin-metric-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .margin-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        .margin-action-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            flex: 1;
            text-align: center;
        }
        
        .margin-action-btn.primary {
            background: linear-gradient(135deg, #32CD32, #228B22);
            border: none;
        }
        
        .margin-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        .product-analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 25px;
        }
        
        .product-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        .product-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #FFD700;
        }
        
        .product-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .optimization-recommendations {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .recommendation-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid;
        }
        
        .recommendation-item.critical { border-left-color: #FF6B6B; }
        .recommendation-item.warning { border-left-color: #FFD93D; }
        .recommendation-item.success { border-left-color: #32CD32; }

        /* Agent System Notifications */
        .recommendation-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--surface-primary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            box-shadow: var(--shadow-heavy);
            z-index: 10000;
            max-width: 400px;
            animation: slideInRight 0.3s ease-out;
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .priority-critical {
            background: var(--danger-color);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .priority-high {
            background: var(--warning-color);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .priority-medium {
            background: var(--secondary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .source {
            color: var(--text-secondary);
            font-size: 0.8em;
        }

        .notification-message {
            color: var(--text-primary);
            font-size: 0.9em;
            line-height: 1.4;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Dashboard Status Indicators */
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online {
            background: var(--success-color);
            box-shadow: 0 0 8px rgba(52, 199, 89, 0.5);
        }

        .status-offline {
            background: var(--danger-color);
            box-shadow: 0 0 8px rgba(255, 59, 48, 0.5);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--gradient-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Navigation */
        .navbar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 1rem 0;
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            margin-bottom: 3rem;
            color: white;
        }

        .hero h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .hero p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 2rem;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .dashboard-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow-heavy);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .dashboard-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .card-icon {
            font-size: 2.5rem;
            margin-right: 1rem;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .card-description {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .card-features {
            list-style: none;
            margin-bottom: 1.5rem;
        }

        .card-features li {
            padding: 0.5rem 0;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
        }

        .card-features li::before {
            content: '✓';
            color: var(--success-color);
            font-weight: bold;
            margin-right: 0.5rem;
        }

        .card-action {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .card-action:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--shadow-medium);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Tools Section */
        .tools-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow-heavy);
            margin-bottom: 2rem;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .tool-card {
            background: var(--surface-tertiary);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .tool-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-medium);
        }

        .tool-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .tool-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .tool-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }

        .status-online {
            background: var(--success-color);
        }

        .status-offline {
            background: var(--danger-color);
        }

        .status-pending {
            background: var(--warning-color);
        }

        /* Animation for shimmer effect */
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>

<!-- ===== AGENT SERVICE AUTO-INJECTION ===== -->
<!-- Generated by Auto-Inject Agents System -->
<script src="bizimhesap-api-integration.js"></script>
<script src="data-aware-agents.js"></script>
<script src="persistent-agent-service.js"></script>
<script src="category-agent-schema.js"></script>

<script>
// Auto-detected page configuration
(function() {
    const currentPage = window.location.pathname.split('/').pop() || 'index.html';
    const agentConfig = window.CategoryAgentSchema ? window.CategoryAgentSchema.getAgentConfig(currentPage) : null;
    
    if (agentConfig) {
        console.log(`🤖 Auto-injecting agents for ${agentConfig.category} page`);
        window.PAGE_CATEGORY = agentConfig.category;
        window.RELEVANT_AGENTS = agentConfig.relevantAgents;
        
        // Initialize when agent service is ready
        function waitForAgentService() {
            if (window.AgentAPI && window.AgentAPI.isServiceActive()) {
                initializePageAgents();
            } else {
                setTimeout(waitForAgentService, 1000);
            }
        }
        
        function initializePageAgents() {
            try {
                console.log(`✅ Agent service ready for ${window.PAGE_CATEGORY}`);
                
                // Get relevant data
                const pageData = window.agentService.getRelevantDataForPage(window.PAGE_CATEGORY);
                
                // Update page with agent data
                updatePageWithAgentData(pageData);
                
                // Setup live update listeners
                setupAgentEventListeners();
                
                // Show agent status widget
                if (typeof showAgentStatusWidget === 'undefined') {
                    createAgentStatusWidget();
                }
                
                // Dispatch ready event
                window.dispatchEvent(new CustomEvent('agentServiceReady', { 
                    detail: { category: window.PAGE_CATEGORY, agents: window.RELEVANT_AGENTS } 
                }));
                
            } catch (error) {
                console.error('❌ Agent initialization error:', error);
            }
        }
        
        function updatePageWithAgentData(data) {
            // Try to update common elements
            updateCommonElements(data);
            
            // Dispatch event for page-specific handling
            window.dispatchEvent(new CustomEvent('agentDataReceived', { detail: data }));
            
            console.log(`📊 Page data updated for ${window.PAGE_CATEGORY}:`, data);
        }
        
        function updateCommonElements(data) {
            // Update common metric elements
            const updates = [
                { selector: '[data-agent-metric="products"]', value: data.product?.data?.products?.length || 0 },
                { selector: '[data-agent-metric="customers"]', value: data.customer?.data?.customers?.length || 0 },
                { selector: '[data-agent-metric="warehouses"]', value: data.warehouse?.data?.warehouses?.length || 0 },
                { selector: '[data-agent-metric="recommendations"]', value: data.recommendations?.length || 0 }
            ];
            
            updates.forEach(update => {
                const elements = document.querySelectorAll(update.selector);
                elements.forEach(el => {
                    if (el) {
                        el.textContent = update.value;
                        el.setAttribute('data-agent-updated', new Date().toISOString());
                    }
                });
            });
            
            // Update status indicators
            const statusElements = document.querySelectorAll('[data-agent-status]');
            statusElements.forEach(el => {
                const agentType = el.getAttribute('data-agent-status');
                if (data[agentType]?.isActive) {
                    el.className = 'agent-status-active';
                    el.textContent = '●';
                    el.style.color = '#10b981';
                } else {
                    el.className = 'agent-status-inactive';
                    el.textContent = '●';
                    el.style.color = '#ef4444';
                }
            });
        }
        
        function setupAgentEventListeners() {
            // Live data sync
            window.addEventListener('agent_service_data_synced', function(event) {
                console.log(`🔄 Live data sync for ${window.PAGE_CATEGORY}`);
                const pageData = window.agentService.getRelevantDataForPage(window.PAGE_CATEGORY);
                updatePageWithAgentData(pageData);
            });
            
            // New recommendations
            window.addEventListener('agent_service_new_recommendation', function(event) {
                if (window.RELEVANT_AGENTS.includes(event.detail.recommendation.source)) {
                    showAgentRecommendation(event.detail.recommendation);
                }
            });
            
            // Agent actions completed
            window.addEventListener('agent_service_agent_action_completed', function(event) {
                console.log(`⚡ Agent action completed for ${window.PAGE_CATEGORY}:`, event.detail);
                showActionCompletedNotification(event.detail);
            });
        }
        
        function createAgentStatusWidget() {
            const widget = document.createElement('div');
            widget.id = 'autoAgentWidget';
            widget.innerHTML = `
                <div style="position: fixed; bottom: 20px; right: 20px; background: #2d3748; color: white; padding: 12px; border-radius: 8px; z-index: 10000; font-size: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); min-width: 200px;">
                    <div style="font-weight: bold; margin-bottom: 8px; color: #e2e8f0;">
                        🤖 ${window.PAGE_CATEGORY.toUpperCase()} AGENTS
                    </div>
                    <div id="agentStatusList">
                        ${window.RELEVANT_AGENTS.map(agent => `
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                <span style="color: #cbd5e0;">${agent}</span>
                                <span data-agent-status="${agent}" style="color: #ef4444;">●</span>
                            </div>
                        `).join('')}
                    </div>
                    <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #4a5568; font-size: 10px; color: #a0aec0;">
                        <span id="agentDataCount">Loading...</span> • Live Data Active
                    </div>
                    <div style="margin-top: 8px;">
                        <button onclick="toggleAgentDetails()" style="background: #4299e1; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 10px;">
                            Details
                        </button>
                        <button onclick="refreshAgentData()" style="background: #48bb78; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 10px; margin-left: 5px;">
                            Refresh
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(widget);
            
            // Update data count
            setTimeout(() => updateAgentDataCount(), 2000);
        }
        
        function updateAgentDataCount() {
            const countEl = document.getElementById('agentDataCount');
            if (countEl && window.AgentAPI) {
                const allData = window.AgentAPI.getAgentData();
                const totalRecords = Object.values(allData).reduce((total, agent) => {
                    if (agent.data) {
                        const count = agent.data.products?.length || 
                                    agent.data.customers?.length || 
                                    agent.data.warehouses?.length || 
                                    agent.data.items?.length || 0;
                        return total + count;
                    }
                    return total;
                }, 0);
                countEl.textContent = `${totalRecords} records`;
            }
        }
        
        window.toggleAgentDetails = function() {
            console.log('🔍 Agent details for', window.PAGE_CATEGORY);
            const data = window.AgentAPI ? window.AgentAPI.getAgentData() : {};
            console.table(data);
            alert(`Agent Details for ${window.PAGE_CATEGORY}:\n\n` + 
                  JSON.stringify(data, null, 2).substring(0, 500) + '...');
        };
        
        window.refreshAgentData = function() {
            console.log('🔄 Refreshing agent data...');
            if (window.AgentAPI) {
                window.AgentAPI.refreshAgentData().then(() => {
                    console.log('✅ Agent data refreshed');
                    updateAgentDataCount();
                });
            }
        };
        
        function showAgentRecommendation(recommendation) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; 
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                color: white; border-radius: 8px; padding: 15px; 
                box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
                z-index: 10001; max-width: 350px;
                animation: slideIn 0.3s ease-out;
            `;
            
            notification.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">
                    💡 ${recommendation.priority} - ${recommendation.source}
                </div>
                <div style="font-size: 14px; line-height: 1.4;">
                    ${recommendation.message}
                </div>
                <div style="margin-top: 10px; text-align: right;">
                    <button onclick="this.parentNode.parentNode.remove()" 
                            style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                        Dismiss
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 10000);
        }
        
        function showActionCompletedNotification(actionData) {
            console.log(`✅ Action completed: ${actionData.action} on ${actionData.agentType}`);
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; left: 20px; 
                background: #10b981; color: white; 
                padding: 10px 15px; border-radius: 6px; 
                z-index: 10001; font-size: 12px;
                animation: slideIn 0.3s ease-out;
            `;
            notification.textContent = `✅ ${actionData.action} completed`;
            
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }
        
        // Start initialization
        setTimeout(waitForAgentService, 1000);
        
    } else {
        console.log('⚠️ No agent configuration found for', currentPage);
    }
})();
</script>

<style>
@keyframes slideIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
}

.agent-status-active { color: #10b981 !important; }
.agent-status-inactive { color: #ef4444 !important; }

[data-agent-metric] {
    font-weight: bold;
    color: #10b981;
}

[data-agent-metric][data-agent-updated] {
    animation: dataUpdated 0.5s ease-out;
}

@keyframes dataUpdated {
    0% { background: rgba(16, 185, 129, 0.2); }
    100% { background: transparent; }
}
</style>
<!-- ===== END AGENT SERVICE AUTO-INJECTION ===== -->

</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="#" class="logo">
                🚴‍♂️ Trek Sales Hub
            </a>
            <div class="nav-actions">
                <button class="nav-btn" onclick="checkSystemStatus()">
                    <span class="status-indicator status-online"></span>
                    Sistem Durumu
                </button>
                <button class="nav-btn" onclick="openApiExplorer()">
                    🔍 API Explorer
                </button>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Profit Filter Panel -->
        <div class="profit-filter-panel" id="profitFilterPanel" style="display: none;">
            <div class="profit-filter-header">
                <div class="profit-filter-title">
                    💰 Kar Potansiyeli Analizi
                </div>
                <button class="update-agents-button" onclick="updateAllAgents()">
                    🤖 Tüm Agentları Güncelle
                </button>
            </div>
            
            <div class="profit-ranking-grid" id="profitRankingGrid">
                <!-- Kar potansiyeli sıralaması buraya gelecek -->
            </div>
            
            <div class="filter-controls">
                <button class="filter-button active" onclick="filterByProfitLevel('all')">Tümü</button>
                <button class="filter-button" onclick="filterByProfitLevel('high')">Yüksek Kar (>€50K)</button>
                <button class="filter-button" onclick="filterByProfitLevel('medium')">Orta Kar (€20K-50K)</button>
                <button class="filter-button" onclick="filterByProfitLevel('low')">Düşük Kar (<€20K)</button>
                <button class="filter-button" onclick="filterByProfitLevel('top5')">Top 5 Kategori</button>
            </div>
        </div>

        <!-- Hero Section -->
        <div class="hero">
            <h1>🎯 Trek Sales Management Hub</h1>
            <p>Comprehensive business management platform with advanced analytics and API integration</p>
        </div>

        <!-- Quick Stats -->
        <div class="quick-stats">
            <div class="stat-card">
                <div class="stat-number" id="totalModules">8</div>
                <div class="stat-label">Aktif Modül</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="apiEndpoints">25+</div>
                <div class="stat-label">API Endpoint</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="integrations">5</div>
                <div class="stat-label">Entegrasyon</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="uptime">99.9%</div>
                <div class="stat-label">Uptime</div>
            </div>
        </div>

        <!-- Main Dashboard Modules -->
        <div class="dashboard-grid">
            <!-- Sales Dashboard -->
            <div class="dashboard-card" onclick="openModule('modern-dashboard.html')">
                <div class="card-header">
                    <div class="card-icon">📊</div>
                    <div class="card-title">Sales Dashboard</div>
                </div>
                <div class="card-description">
                    Comprehensive sales tracking, employee management, and commission calculations with real-time analytics.
                </div>
                <ul class="card-features">
                    <li>Commission Calculations</li>
                    <li>Employee Performance</li>
                    <li>Stock Monitoring</li>
                    <li>AI Assistant Integration</li>
                </ul>
                <button class="card-action">Open Sales Dashboard</button>
            </div>

            <!-- Customer Analytics -->
            <div class="dashboard-card" onclick="openModule('customer-analytics.html')">
                <div class="card-header">
                    <div class="card-icon">👥</div>
                    <div class="card-title">Customer Analytics</div>
                </div>
                <div class="card-description">
                    Advanced customer analysis with Abstract API integration, segmentation, and behavior tracking.
                </div>
                <ul class="card-features">
                    <li>Email Domain Analysis</li>
                    <li>Balance Segmentation</li>
                    <li>Currency Distribution</li>
                    <li>Risk Assessment</li>
                </ul>
                <button class="card-action">Analyze Customers</button>
            </div>

            <!-- Invoice Management -->
            <div class="dashboard-card" onclick="openModule('invoice-management.html')">
                <div class="card-header">
                    <div class="card-icon">🧾</div>
                    <div class="card-title">Invoice Management</div>
                </div>
                <div class="card-description">
                    Complete invoice lifecycle management with creation, tracking, and analytics capabilities.
                </div>
                <ul class="card-features">
                    <li>Invoice Creation</li>
                    <li>Payment Tracking</li>
                    <li>PDF Generation</li>
                    <li>Automated Workflows</li>
                </ul>
                <button class="card-action">Manage Invoices</button>
            </div>

            <!-- Product Catalog -->
            <div class="dashboard-card" onclick="openModule('product-catalog.html')">
                <div class="card-header">
                    <div class="card-icon">🛍️</div>
                    <div class="card-title">Product Catalog</div>
                </div>
                <div class="card-description">
                    Complete product management with inventory tracking, categories, and pricing analytics.
                </div>
                <ul class="card-features">
                    <li>Product Database</li>
                    <li>Category Management</li>
                    <li>Inventory Tracking</li>
                    <li>Price Analytics</li>
                </ul>
                <button class="card-action">Browse Catalog</button>
            </div>

            <!-- Warehouse Management -->
            <div class="dashboard-card" onclick="openModule('warehouse-management.html')">
                <div class="card-header">
                    <div class="card-icon">🏭</div>
                    <div class="card-title">Warehouse Management</div>
                </div>
                <div class="card-description">
                    Multi-warehouse inventory management with stock levels, transfers, and optimization.
                </div>
                <ul class="card-features">
                    <li>Multi-Warehouse Support</li>
                    <li>Stock Level Monitoring</li>
                    <li>Transfer Management</li>
                    <li>Optimization Algorithms</li>
                </ul>
                <button class="card-action">Manage Warehouses</button>
            </div>

            <!-- Financial Reports -->
            <div class="dashboard-card" onclick="openModule('financial-reports-dashboard.html')">
                <div class="card-header">
                    <div class="card-icon">💰</div>
                    <div class="card-title">Financial Reports</div>
                </div>
                <div class="card-description">
                    Advanced financial analytics with P&L statements, cash flow analysis, and forecasting.
                </div>
                <ul class="card-features">
                    <li>P&L Statements</li>
                    <li>Cash Flow Analysis</li>
                    <li>Financial Forecasting</li>
                    <li>KPI Tracking</li>
                </ul>
                <button class="card-action">View Reports</button>
            </div>

            <!-- Admin Panel -->
            <div class="dashboard-card" onclick="openModule('admin-panel.html')">
                <div class="card-header">
                    <div class="card-icon">⚙️</div>
                    <div class="card-title">Administration</div>
                </div>
                <div class="card-description">
                    System administration, user management, and configuration settings.
                </div>
                <ul class="card-features">
                    <li>User Management</li>
                    <li>System Settings</li>
                    <li>Security Controls</li>
                    <li>Backup Management</li>
                </ul>
                <button class="card-action">Admin Settings</button>
            </div>

            <!-- API Integration -->
            <div class="dashboard-card" onclick="openModule('api-integration.html')">
                <div class="card-header">
                    <div class="card-icon">🔗</div>
                    <div class="card-title">API Integration</div>
                </div>
                <div class="card-description">
                    Complete API management with endpoint testing, data synchronization, and monitoring.
                </div>
                <ul class="card-features">
                    <li>Endpoint Testing</li>
                    <li>Data Synchronization</li>
                    <li>API Monitoring</li>
                    <li>Integration Health</li>
                </ul>
                <button class="card-action">Manage APIs</button>
            </div>

            <!-- Profit Margin Analysis -->
            <div class="dashboard-card" onclick="openMarginAnalysisTab()">
                <div class="card-header">
                    <div class="card-icon">💹</div>
                    <div class="card-title">Kar Marj Analizi</div>
                </div>
                <div class="card-description">
                    Advanced profit margin analysis with category and product-based optimization strategies.
                </div>
                <ul class="card-features">
                    <li>Category-Based Analysis</li>
                    <li>Product-Level Margins</li>
                    <li>Optimization Recommendations</li>
                    <li>Pricing Strategies</li>
                </ul>
                <button class="card-action">Analyze Margins</button>
            </div>
        </div>

        <!-- Development Tools -->
        <div class="tools-section">
            <h3 style="margin-bottom: 1.5rem; text-align: center;">🛠️ Development Tools</h3>
            <div class="tools-grid">
                <div class="tool-card" onclick="openTool('api-explorer.html')">
                    <div class="tool-icon">🔍</div>
                    <div class="tool-title">API Explorer</div>
                    <div class="tool-description">Test and explore API endpoints</div>
                </div>
                
                <div class="tool-card" onclick="openTool('test-abstract.html')">
                    <div class="tool-icon">📊</div>
                    <div class="tool-title">Abstract Tester</div>
                    <div class="tool-description">Test customer abstract API</div>
                </div>
                
                <div class="tool-card" onclick="openTool('test-invoices.html')">
                    <div class="tool-icon">🧾</div>
                    <div class="tool-title">Invoice Tester</div>
                    <div class="tool-description">Test invoice endpoints</div>
                </div>
                
                <div class="tool-card" onclick="openTool('add-invoice.html')">
                    <div class="tool-icon">➕</div>
                    <div class="tool-title">Add Invoice</div>
                    <div class="tool-description">Create new invoices</div>
                </div>
                
                <div class="tool-card" onclick="openTool('invoice-tracker.html')">
                    <div class="tool-icon">📋</div>
                    <div class="tool-title">Invoice Tracker</div>
                    <div class="tool-description">Track invoice history</div>
                </div>
                
                <div class="tool-card" onclick="openTool('test-real-bizimhesap-endpoints.html')">
                    <div class="tool-icon">🔐</div>
                    <div class="tool-title">Auth Endpoint Tester</div>
                    <div class="tool-description">Test authenticated Bizimhesap endpoints</div>
                </div>
                
                <div class="tool-card" onclick="openTool('integrated-bizimhesap-hub.html')">
                    <div class="tool-icon">🚀</div>
                    <div class="tool-title">Integrated Hub</div>
                    <div class="tool-description">Full Bizimhesap integration dashboard</div>
                </div>
                
                <div class="tool-card" onclick="openTool('comprehensive-data-extractor.html')">
                    <div class="tool-icon">🔍</div>
                    <div class="tool-title">Data Extractor</div>
                    <div class="tool-description">Comprehensive data analysis and extraction</div>
                </div>
                
                <div class="tool-card" onclick="openTool('real-time-bizimhesap-sync.html')">
                    <div class="tool-icon">🔄</div>
                    <div class="tool-title">Real-Time Sync</div>
                    <div class="tool-description">Live Bizimhesap data synchronization</div>
                </div>
                
                <div class="tool-card" onclick="openTool('invoice-order-viewer.html')">
                    <div class="tool-icon">📋</div>
                    <div class="tool-title">Invoice & Order Viewer</div>
                    <div class="tool-description">View authenticated business invoices and orders</div>
                </div>
                
                <div class="tool-card" onclick="openTool('financial-reports-dashboard.html')">
                    <div class="tool-icon">💰</div>
                    <div class="tool-title">Financial Reports</div>
                    <div class="tool-description">Advanced financial analytics and commission tracking</div>
                </div>
                
                <div class="tool-card" onclick="openTool('stock-alerts-dashboard.html')">
                    <div class="tool-icon">📦</div>
                    <div class="tool-title">Stock Alerts</div>
                    <div class="tool-description">Real-time stock monitoring and alert system</div>
                </div>
            </div>
        </div>

        <!-- Advanced Data Tools -->
        <div class="tools-section">
            <h3 style="margin-bottom: 1.5rem; text-align: center;">🚀 Advanced Data Extraction & Analysis</h3>
            <div class="tools-grid">
                <div class="tool-card" onclick="openTool('cors-bypass-extractor.html')">
                    <div class="tool-icon">🔄</div>
                    <div class="tool-title">CORS Bypass Extractor</div>
                    <div class="tool-description">6 CORS bypass methods for data extraction</div>
                </div>
                
                <div class="tool-card" onclick="openTool('advanced-form-extractor.html')">
                    <div class="tool-icon">📋</div>
                    <div class="tool-title">Advanced Form Extractor</div>
                    <div class="tool-description">Form-based data extraction system</div>
                </div>
                
                <div class="tool-card" onclick="openTool('automated-report-generator.html')">
                    <div class="tool-icon">📊</div>
                    <div class="tool-title">Automated Report Generator</div>
                    <div class="tool-description">Auto report generation with filters</div>
                </div>
                
                <div class="tool-card" onclick="openTool('csp-bypass-report-generator.html')">
                    <div class="tool-icon">🔥</div>
                    <div class="tool-title">CSP Bypass Generator</div>
                    <div class="tool-description">Content Security Policy bypass methods</div>
                </div>
                
                <div class="tool-card" onclick="openTool('bizimhesap-explorer.html')">
                    <div class="tool-icon">🕷️</div>
                    <div class="tool-title">Bizimhesap Explorer</div>
                    <div class="tool-description">Full system exploration and mapping</div>
                </div>
                
                <div class="tool-card" onclick="openTool('data-extraction-engine.html')">
                    <div class="tool-icon">⚡</div>
                    <div class="tool-title">Data Extraction Engine</div>
                    <div class="tool-description">Comprehensive extraction with analytics</div>
                </div>
                
                <div class="tool-card" onclick="openTool('ultimate-data-harvester.html')">
                    <div class="tool-icon">💎</div>
                    <div class="tool-title">Ultimate Data Harvester</div>
                    <div class="tool-description">Advanced security bypass methods</div>
                </div>
                
                <div class="tool-card" onclick="openTool('legitimate-data-extractor.html')">
                    <div class="tool-icon">✅</div>
                    <div class="tool-title">Legitimate Data Extractor</div>
                    <div class="tool-description">Session-based authentic extraction</div>
                </div>
            </div>
        </div>

        <!-- GitHub & AI Powered Tools -->
        <div class="tools-section">
            <h3 style="margin-bottom: 1.5rem; text-align: center;">🤖 GitHub & AI Powered Solutions</h3>
            <div class="tools-grid">
                <div class="tool-card" onclick="openTool('advanced-github-data-harvester.html')">
                    <div class="tool-icon">🔄</div>
                    <div class="tool-title">GitHub CORS Bypass</div>
                    <div class="tool-description">samdenty/cors-bypass implementation</div>
                </div>
                
                <div class="tool-card" onclick="openTool('fixed-github-data-harvester.html')">
                    <div class="tool-icon">🔧</div>
                    <div class="tool-title">Fixed GitHub Harvester</div>
                    <div class="tool-description">Error-free GitHub solutions</div>
                </div>
                
                <div class="tool-card" onclick="openTool('working-data-harvester.html')">
                    <div class="tool-icon">⚙️</div>
                    <div class="tool-title">Working Data Harvester</div>
                    <div class="tool-description">Functional extraction system</div>
                </div>
                
                <div class="tool-card" onclick="openTool('clean-data-harvester.html')">
                    <div class="tool-icon">✨</div>
                    <div class="tool-title">Clean Data Harvester</div>
                    <div class="tool-description">Clean, syntax-error-free version</div>
                </div>
                
                <div class="tool-card" onclick="openTool('debug-harvester.html')">
                    <div class="tool-icon">🔍</div>
                    <div class="tool-title">Debug Harvester</div>
                    <div class="tool-description">Debug and testing utility</div>
                </div>
                
                <div class="tool-card" onclick="openTool('real-data-extractor.html')">
                    <div class="tool-icon">🎯</div>
                    <div class="tool-title">Real Data Extractor</div>
                    <div class="tool-description">Multiple extraction methods</div>
                </div>
                
                <div class="tool-card" onclick="openTool('interactive-data-analyzer.html')">
                    <div class="tool-icon">🧠</div>
                    <div class="tool-title">Interactive Data Analyzer</div>
                    <div class="tool-description">Claude-compatible data analysis</div>
                </div>
                
                <div class="tool-card" onclick="openTool('autonomous-data-system.html')">
                    <div class="tool-icon">🤖</div>
                    <div class="tool-title">Autonomous Data System</div>
                    <div class="tool-description">Zero human intervention system</div>
                </div>
            </div>
        </div>

        <!-- Claude Business Intelligence -->
        <div class="tools-section">
            <h3 style="margin-bottom: 1.5rem; text-align: center;">🧠 Claude Business Intelligence</h3>
            <div class="tools-grid">
                <div class="tool-card" onclick="openTool('claude-business-analysis.html')">
                    <div class="tool-icon">📊</div>
                    <div class="tool-title">Claude Business Analysis</div>
                    <div class="tool-description">Comprehensive Trek business analysis</div>
                </div>
                
                <div class="tool-card" onclick="openTool('simple-claude-analysis.html')">
                    <div class="tool-icon">📝</div>
                    <div class="tool-title">Simple Claude Analysis</div>
                    <div class="tool-description">Simplified business intelligence report</div>
                </div>
                
                <div class="tool-card" onclick="openTool('simple-test.html')">
                    <div class="tool-icon">🧪</div>
                    <div class="tool-title">Simple Test Tool</div>
                    <div class="tool-description">Basic functionality testing</div>
                </div>
            </div>
        </div>

        <!-- Authentication & Login Tools -->
        <div class="tools-section">
            <h3 style="margin-bottom: 1.5rem; text-align: center;">🔐 Authentication & Session Management</h3>
            <div class="tools-grid">
                <div class="tool-card" onclick="openTool('bizimhesap-captcha-bypass.cjs')">
                    <div class="tool-icon">🔓</div>
                    <div class="tool-title">CAPTCHA Bypass Script</div>
                    <div class="tool-description">2Captcha + Playwright automation</div>
                </div>
                
                <div class="tool-card" onclick="openTool('auto-session-handler.js')">
                    <div class="tool-icon">🔄</div>
                    <div class="tool-title">Auto Session Handler</div>
                    <div class="tool-description">Automatic session monitoring</div>
                </div>
                
                <div class="tool-card" onclick="openTool('load-session-data.html')">
                    <div class="tool-icon">📦</div>
                    <div class="tool-title">Session Data Loader</div>
                    <div class="tool-description">Load session data to localStorage</div>
                </div>
            </div>
        </div>

        <!-- AI Learning & Knowledge Systems -->
        <div class="tools-section">
            <h3 style="margin-bottom: 1.5rem; text-align: center;">🧠 AI Learning & Knowledge Systems</h3>
            <div class="tools-grid">
                <div class="tool-card" onclick="openTool('ai-data-learning-system.html')">
                    <div class="tool-icon">🤖</div>
                    <div class="tool-title">AI Data Learning System</div>
                    <div class="tool-description">Claude & OpenAI integration for business data learning</div>
                </div>
                
                <div class="tool-card" onclick="openTool('crm-ai-tools-integration.html')">
                    <div class="tool-icon">🛠️</div>
                    <div class="tool-title">CRM AI Tools Integration</div>
                    <div class="tool-description">GitHub open-source AI CRM tools and APIs</div>
                </div>
                
                <div class="tool-card" onclick="openTool('automated-learning-orchestrator.html')">
                    <div class="tool-icon">🎯</div>
                    <div class="tool-title">Automated Learning Orchestrator</div>
                    <div class="tool-description">Autonomous AI knowledge acquisition system</div>
                </div>
                
                <div class="tool-card" onclick="openTool('api-data-learning-integration.html')">
                    <div class="tool-icon">🔄</div>
                    <div class="tool-title">API Data Learning Integration</div>
                    <div class="tool-description">Real-time API data monitoring and AI learning</div>
                </div>
                
                <div class="tool-card" onclick="openTool('intelligent-data-agents.html')">
                    <div class="tool-icon">🤖</div>
                    <div class="tool-title">Intelligent Data Agents</div>
                    <div class="tool-description">Specialized AI agents for continuous business intelligence</div>
                </div>
                
                <div class="tool-card" onclick="openTool('continuous-thinking-agents.html')">
                    <div class="tool-icon">🧠</div>
                    <div class="tool-title">Continuous Thinking Agents</div>
                    <div class="tool-description">24/7 autonomous analysis and prediction system</div>
                </div>
                
                <div class="tool-card" onclick="openTool('agent-knowledge-capabilities.html')">
                    <div class="tool-icon">📚</div>
                    <div class="tool-title">Agent Knowledge Framework</div>
                    <div class="tool-description">2025 AI agent capabilities and knowledge research</div>
                </div>
                
                <div class="tool-card" onclick="openTool('bizimhesap-data-analysis-agents.html')">
                    <div class="tool-icon">📊</div>
                    <div class="tool-title">Bizimhesap Analysis Agents</div>
                    <div class="tool-description">Specialized agents for Bizimhesap sales & stock analysis</div>
                </div>
                
                <div class="tool-card" onclick="openTool('bizimhesap-extraction-methods.html')">
                    <div class="tool-icon">🛠️</div>
                    <div class="tool-title">Data Extraction Methods</div>
                    <div class="tool-description">6 different ways to extract Bizimhesap data</div>
                </div>
                
                <div class="tool-card" onclick="openTool('ceo-assistant-agents-chat.html')">
                    <div class="tool-icon">👔</div>
                    <div class="tool-title">CEO Assistant AI Chat</div>
                    <div class="tool-description">Executive-level conversational AI agents for business intelligence</div>
                </div>
                
                <div class="tool-card" onclick="openTool('harvard-mba-ai-consultants.html')" style="border: 2px solid #10b981; background: rgba(16, 185, 129, 0.1);">
                    <div class="tool-icon">🎓</div>
                    <div class="tool-title">Harvard MBA AI Consultants ✅</div>
                    <div class="tool-description">McKinsey/BCG level strategic consultants - REAL GPT-4/Claude API Integration</div>
                    <div style="margin-top: 10px; font-size: 0.8rem; color: #10b981; font-weight: 600;">🚀 REAL AI POWERED - API INTEGRATED</div>
                </div>
                
                <div class="tool-card" onclick="openTool('ceo-360-analytics-framework.html')" style="border: 3px solid #8b5cf6; background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(6, 182, 212, 0.1)); box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);">
                    <div class="tool-icon" style="font-size: 2.5rem; background: linear-gradient(45deg, #8b5cf6, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">🎯</div>
                    <div class="tool-title" style="color: #8b5cf6; font-weight: 800;">CEO 360° Analytics Framework ⭐</div>
                    <div class="tool-description">Complete business intelligence with GPT-OSS-20B, Multi-Agent Systems, Predictive Analytics</div>
                    <div style="margin-top: 15px; padding: 10px; background: rgba(139, 92, 246, 0.1); border-radius: 8px; border: 1px solid #8b5cf6;">
                        <div style="font-size: 0.75rem; color: #8b5cf6; font-weight: 700; margin-bottom: 5px;">🚀 NEXT-GENERATION ANALYTICS</div>
                        <div style="font-size: 0.7rem; color: #6b46c1;">• Multi-Agent Data Processing • GPT-OSS-20B Integration • Real-time KPIs • Monte-Carlo Simulations</div>
                    </div>
                </div>
                
                <div class="tool-card" onclick="openTool('ceo-command-center.html')" style="border: 4px solid #10b981; background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(34, 197, 94, 0.15)); box-shadow: 0 15px 40px rgba(16, 185, 129, 0.4); position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 6px; background: linear-gradient(90deg, #10b981, #059669, #22c55e); animation: shimmer 2s infinite;"></div>
                    <div class="tool-icon" style="font-size: 3rem; background: linear-gradient(45deg, #10b981, #22c55e); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 20px rgba(16, 185, 129, 0.5);">🎯</div>
                    <div class="tool-title" style="color: #10b981; font-weight: 900; font-size: 1.2rem;">CEO COMMAND CENTER 🚀</div>
                    <div class="tool-description" style="font-weight: 600;">GPT-5 Orchestrator - Merkezi Komuta Sistemi - 6 Sub-Agent Yönetimi</div>
                    <div style="margin-top: 15px; padding: 12px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(34, 197, 94, 0.1)); border-radius: 10px; border: 2px solid #10b981;">
                        <div style="font-size: 0.8rem; color: #10b981; font-weight: 800; margin-bottom: 8px;">⚡ GPT-5 CEO ORCHESTRATOR LIVE</div>
                        <div style="font-size: 0.75rem; color: #059669; line-height: 1.4;">• Real OpenAI GPT-5 API • Sales/Finance/Stock/CRM/Logistics Agents • Claude Support • Instant CEO Reports</div>
                        <div style="margin-top: 8px; font-size: 0.7rem; color: #22c55e; font-weight: 700;">🔥 YENİ: Merkezi CEO Asistanı - Tüm Alt-Agentları Yönetir</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Margin Analysis Modal -->
    <div id="marginAnalysisModal" class="margin-analysis-modal">
        <div class="margin-modal-content">
            <div class="margin-modal-header">
                <h2 class="margin-modal-title">💹 Kar Marj Analizi</h2>
                <button class="margin-modal-close" onclick="closeMarginAnalysisModal()">✕</button>
            </div>
            
            <div class="margin-tab-navigation">
                <button class="margin-tab-btn active" onclick="switchMarginTab(event, 'overview')">📊 Genel Bakış</button>
                <button class="margin-tab-btn" onclick="switchMarginTab(event, 'categories')">🏷️ Kategori Analizi</button>
                <button class="margin-tab-btn" onclick="switchMarginTab(event, 'products')">📦 Ürün Analizi</button>
                <button class="margin-tab-btn" onclick="switchMarginTab(event, 'optimization')">🎯 Optimizasyon</button>
            </div>
            
            <div class="margin-tab-content">
                <!-- Overview Tab -->
                <div id="marginOverviewTab" class="margin-tab-panel">
                    <div class="margin-summary-grid">
                        <div class="margin-summary-card">
                            <div class="margin-summary-value" id="totalProfitPotentialModal">€0</div>
                            <div class="margin-summary-label">Toplam Kar Potansiyeli</div>
                        </div>
                        <div class="margin-summary-card">
                            <div class="margin-summary-value" id="avgMarginRateModal">0%</div>
                            <div class="margin-summary-label">Ortalama Marj Oranı</div>
                        </div>
                        <div class="margin-summary-card">
                            <div class="margin-summary-value" id="totalCategoriesModal">0</div>
                            <div class="margin-summary-label">Toplam Kategori</div>
                        </div>
                        <div class="margin-summary-card">
                            <div class="margin-summary-value" id="optimizationOpportunitiesModal">0</div>
                            <div class="margin-summary-label">Optimizasyon Fırsatı</div>
                        </div>
                    </div>
                    
                    <div class="optimization-recommendations">
                        <h3 style="margin-bottom: 20px;">🎯 Acil Öneriler</h3>
                        <div id="urgentRecommendations">
                            <!-- Acil öneriler buraya gelecek -->
                        </div>
                    </div>
                </div>
                
                <!-- Categories Tab -->
                <div id="marginCategoriesTab" class="margin-tab-panel" style="display: none;">
                    <div class="margin-category-grid" id="categoryMarginGrid">
                        <!-- Kategori kartları buraya gelecek -->
                    </div>
                </div>
                
                <!-- Products Tab -->
                <div id="marginProductsTab" class="margin-tab-panel" style="display: none;">
                    <div class="product-analysis-grid" id="productMarginGrid">
                        <!-- Ürün kartları buraya gelecek -->
                    </div>
                </div>
                
                <!-- Optimization Tab -->
                <div id="marginOptimizationTab" class="margin-tab-panel" style="display: none;">
                    <div class="optimization-recommendations">
                        <h3 style="margin-bottom: 20px;">💡 Optimizasyon Stratejileri</h3>
                        <div id="optimizationStrategies">
                            <!-- Optimizasyon stratejileri buraya gelecek -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Include Data-Aware Agents -->
    <script src="data-aware-agents.js"></script>
    <script src="real-time-bizimhesap-monitor.js"></script>

    <script>
        // Global variables for agent system
        let bizimHesapAPI = null;
        let agentOrchestrator = null;
        let realTimeMonitor = null;
        let categoryMappings = {};

        // Tax calculation for margin analysis
        function initializeTaxSchema() {
            const saved = localStorage.getItem('categoryMappings');
            if (saved) {
                try {
                    categoryMappings = JSON.parse(saved);
                    console.log('✅ Vergi şeması yüklendi:', Object.keys(categoryMappings).length, 'kategori');
                } catch (error) {
                    console.error('Vergi şeması yükleme hatası:', error);
                }
            } else {
                // Default tax schema - same as real-bicycle-dashboard
                categoryMappings = {
                    "dsw-bisiklet": {
                        "name": "DSW BİSİKLET",
                        "categories": ["FX", "DS", "MARLIN"],
                        "taxRate": 70
                    },
                    "nci-bisiklet": {
                        "name": "NCI BİSİKLET",
                        "categories": ["MADONE", "EMONDA", "DOMANE", "POWERFLY", "PROCALIBER", "CHECKPOINT", "SPEED CONCEPT", "RAIL", "DOMANE+", "SUPERCALIBER", "VERVE+", "FUEL EXE", "MARLİN+", "FX+", "KADRO", "TOWNIE GO!", "DS+", "TOP FUEL"],
                        "taxRate": 35
                    },
                    "dsw-aksesuar": {
                        "name": "DSW AKSESUAR",
                        "categories": ["VERVE", "AYDINLATMA", "ÇANTA", "İÇ LASTİK", "GİDON BOĞAZI", "BAGAJ-SEPET", "MATARA-KAFES", "ELCİK-GİDON BANDI", "KADRO KULAĞI", "PEDAL", "POMPA", "ZİL", "KİLİT", "KASK", "ELDİVEN", "DIŞ LASTİK", "SELE-SELE BORUSU", "ERKEK AYAKKABI", "Tanımsız", "ÇAMURLUK", "ANAHTAR TAKIMI", "PARK AYAĞI", "YEDEK PARÇA", "ELECTRA KADIN BİSİKLET"],
                        "taxRate": 60
                    },
                    "nci-aksesuar": {
                        "name": "NCI AKSESUAR",
                        "categories": ["JANT SETİ", "GİDON", "BLENDR AYDINLATMA MONTAJ"],
                        "taxRate": 40
                    },
                    "gobik": {
                        "name": "GOBİK",
                        "categories": ["İÇLİK", "FORMA", "ÇORAP", "RÜZGARLIK-YAĞMURLUK", "TAYT-ŞORT", "KOL VE DİZ ISITICI"],
                        "taxRate": 33
                    },
                    "trieye": {
                        "name": "TriEye",
                        "categories": ["Gözlük"],
                        "taxRate": 68
                    },
                    "bryton": {
                        "name": "Bryton",
                        "categories": ["KM SAATİ"],
                        "taxRate": 65
                    },
                    "saris": {
                        "name": "Saris",
                        "categories": ["ARAÇ ARKASI TAŞIYICI"],
                        "taxRate": 65
                    }
                };
                localStorage.setItem('categoryMappings', JSON.stringify(categoryMappings));
                console.log('💾 Varsayılan vergi şeması kaydedildi');
            }
        }

        function getTaxRateForCategory(category) {
            if (!category) return 20;
            
            const categoryUpper = category.toUpperCase();
            for (const [key, mapping] of Object.entries(categoryMappings)) {
                if (mapping.categories) {
                    const categoryMatch = mapping.categories.some(cat => {
                        const catUpper = cat.toUpperCase();
                        return categoryUpper.includes(catUpper) || catUpper.includes(categoryUpper);
                    });
                    if (categoryMatch) {
                        console.log(`📋 Kategori vergi oranı: ${category} → ${mapping.taxRate}%`);
                        return mapping.taxRate;
                    }
                }
            }
            console.log(`⚠️ Kategori eşleşmedi: ${category} → varsayılan 20%`);
            return 20;
        }
        let dashboardData = {
            products: 0,
            customers: 0,
            warehouses: 0,
            stockValue: 0,
            criticalAlerts: 0,
            recommendations: 0
        };

        // Module navigation
        function openModule(moduleUrl) {
            window.open(moduleUrl, '_blank');
        }

        function openTool(toolUrl) {
            window.open(toolUrl, '_blank');
        }

        function openApiExplorer() {
            window.open('api-explorer.html', '_blank');
        }

        // Enhanced system status check with agent data
        async function checkSystemStatus() {
            try {
                // Check proxy server
                const proxyResponse = await fetch('/api-proxy.php?endpoint=/api/b2b/products');
                const statusIndicator = document.querySelector('.status-indicator');
                
                if (proxyResponse.ok) {
                    statusIndicator.className = 'status-indicator status-online';
                    
                    // Check BizimHesap API connection
                    const apiResponse = await fetch('/api-proxy.php?endpoint=/api/b2b/products');
                    if (apiResponse.ok) {
                        console.log('✅ BizimHesap API bağlantısı aktif');
                        updateDashboardWithLiveData();
                    }
                } else {
                    statusIndicator.className = 'status-indicator status-offline';
                    console.log('❌ Proxy server bağlantısı başarısız');
                }
            } catch (error) {
                document.querySelector('.status-indicator').className = 'status-indicator status-offline';
                console.log('❌ Sistem offline - Sunucu bağlantısı kurulamadı');
            }
        }

        // Update dashboard with live agent data
        async function updateDashboardWithLiveData() {
            if (!agentOrchestrator) return;
            
            try {
                const agentData = agentOrchestrator.getAgentData();
                const analysisResults = agentOrchestrator.getAnalysisResults();
                const recommendations = agentOrchestrator.getPendingRecommendations();
                
                // Update dashboard metrics
                if (agentData.product?.data?.products) {
                    dashboardData.products = agentData.product.data.products.length;
                }
                
                if (agentData.customer?.data?.customers) {
                    dashboardData.customers = agentData.customer.data.customers.length;
                }
                
                if (agentData.warehouse?.data?.warehouses) {
                    dashboardData.warehouses = agentData.warehouse.data.warehouses.length;
                }
                
                if (agentData.inventory?.data?.totalValue) {
                    dashboardData.stockValue = agentData.inventory.data.totalValue;
                }
                
                // Count critical alerts
                dashboardData.criticalAlerts = Object.values(analysisResults).reduce((count, analysis) => {
                    if (analysis.criticalStockProducts) count += analysis.criticalStockProducts.length;
                    if (analysis.criticalItems) count += analysis.criticalItems.length;
                    return count;
                }, 0);
                
                dashboardData.recommendations = recommendations.length;
                
                // Update UI elements
                updateDashboardUI();
                
                console.log('📊 Dashboard güncellendi:', dashboardData);
                
            } catch (error) {
                console.error('❌ Dashboard veri güncellemesi başarısız:', error);
            }
        }

        // Update dashboard UI with current data
        function updateDashboardUI() {
            // Update stats if elements exist
            const stats = [
                { selector: '.stat-number[data-metric="products"]', value: dashboardData.products },
                { selector: '.stat-number[data-metric="customers"]', value: dashboardData.customers },
                { selector: '.stat-number[data-metric="warehouses"]', value: dashboardData.warehouses },
                { selector: '.stat-number[data-metric="alerts"]', value: dashboardData.criticalAlerts },
                { selector: '.stat-number[data-metric="recommendations"]', value: dashboardData.recommendations }
            ];
            
            stats.forEach(stat => {
                const element = document.querySelector(stat.selector);
                if (element) {
                    animateNumber(element, stat.value.toString());
                }
            });

            // Update stock value display
            const stockValueElement = document.querySelector('.stat-number[data-metric="stock-value"]');
            if (stockValueElement && dashboardData.stockValue > 0) {
                const formattedValue = `₺${dashboardData.stockValue.toLocaleString()}`;
                stockValueElement.textContent = formattedValue;
            }
        }

        // Initialize agent system
        async function initializeAgentSystem() {
            console.log('🤖 Initializing Agent System...');
            
            try {
                // Wait for BizimHesapAPI to be available
                if (typeof BizimHesapAPI !== 'undefined') {
                    bizimHesapAPI = new BizimHesapAPI();
                    console.log('✅ BizimHesap API initialized');
                    
                    // Wait a bit for API to connect
                    setTimeout(async () => {
                        if (typeof DataAwareAgentOrchestrator !== 'undefined') {
                            agentOrchestrator = new DataAwareAgentOrchestrator(bizimHesapAPI);
                            console.log('✅ Agent Orchestrator initialized');
                            
                            // Listen for agent events
                            setupAgentEventListeners();
                            
                            // Start periodic dashboard updates
                            setInterval(updateDashboardWithLiveData, 30000); // Every 30 seconds
                        }
                        
                        if (typeof RealTimeBizimHesapMonitor !== 'undefined') {
                            realTimeMonitor = new RealTimeBizimHesapMonitor();
                            console.log('✅ Real-time Monitor initialized');
                        }
                    }, 3000);
                } else {
                    console.warn('⚠️ BizimHesapAPI not available');
                    // Retry after a delay
                    setTimeout(() => {
                        if (typeof BizimHesapAPI !== 'undefined') {
                            bizimHesapAPI = new BizimHesapAPI();
                            console.log('✅ BizimHesap API initialized (retry)');
                        }
                    }, 2000);
                }
            } catch (error) {
                console.error('❌ Agent system initialization failed:', error);
            }
        }

        // Setup event listeners for agent events
        function setupAgentEventListeners() {
            // Listen for agent analysis completion
            window.addEventListener('agent_orchestrator_agent_analysis_complete', (event) => {
                console.log('📊 Agent analysis completed:', event.detail);
                updateDashboardWithLiveData();
            });
            
            // Listen for agent recommendations
            window.addEventListener('agent_orchestrator_agent_recommendation', (event) => {
                console.log('💡 New recommendation:', event.detail.recommendation);
                
                // Show recommendation notification
                showRecommendationNotification(event.detail.recommendation);
            });
            
            // Listen for monitoring events
            window.addEventListener('bizimhesap_monitor_data_synced', (event) => {
                console.log('🔄 Data synced:', event.detail);
            });
        }

        // Show recommendation notification
        function showRecommendationNotification(recommendation) {
            const notification = document.createElement('div');
            notification.className = 'recommendation-notification';
            notification.innerHTML = `
                <div class="notification-header">
                    <span class="priority-${recommendation.priority.toLowerCase()}">${recommendation.priority}</span>
                    <span class="source">${recommendation.source}</span>
                </div>
                <div class="notification-message">${recommendation.message}</div>
            `;
            
            // Add to page temporarily
            document.body.appendChild(notification);
            
            // Remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }

        // Auto-check system status on load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkSystemStatus, 2000);
            setTimeout(initializeAgentSystem, 3000);
            
            // Animate stats
            animateStats();
        });

        function animateStats() {
            const statNumbers = document.querySelectorAll('.stat-number');
            statNumbers.forEach((stat, index) => {
                const finalValue = stat.textContent;
                stat.textContent = '0';
                
                setTimeout(() => {
                    animateNumber(stat, finalValue);
                }, index * 200);
            });
        }

        function animateNumber(element, finalValue) {
            const isPercentage = finalValue.includes('%');
            const isPlus = finalValue.includes('+');
            const numericValue = parseFloat(finalValue.replace(/[^\d.]/g, ''));
            
            let current = 0;
            const increment = numericValue / 30;
            
            const timer = setInterval(() => {
                current += increment;
                if (current >= numericValue) {
                    current = numericValue;
                    clearInterval(timer);
                }
                
                let displayValue = Math.floor(current);
                if (isPercentage) displayValue += '%';
                if (isPlus) displayValue += '+';
                
                element.textContent = displayValue;
            }, 50);
        }

        // Profit Filter Functions
        let profitRankingData = [];
        let currentProfitFilter = 'all';
        
        function loadProfitFilterData() {
            // Real bicycle dashboard'dan gelen veriyi kontrol et
            const savedData = localStorage.getItem('agentUpdateData');
            if (savedData) {
                try {
                    const agentData = JSON.parse(savedData);
                    profitRankingData = agentData.profitRanking || [];
                    
                    if (profitRankingData.length > 0) {
                        document.getElementById('profitFilterPanel').style.display = 'block';
                        updateProfitRankingGrid();
                        console.log('💰 Profit filter data loaded:', profitRankingData.length, 'categories');
                    }
                } catch (error) {
                    console.error('Error loading profit filter data:', error);
                }
            }
        }
        
        function updateProfitRankingGrid() {
            const grid = document.getElementById('profitRankingGrid');
            let filteredData = [...profitRankingData];
            
            // Filtre uygula
            switch(currentProfitFilter) {
                case 'high':
                    filteredData = filteredData.filter(cat => cat.profitPotential > 50000);
                    break;
                case 'medium':
                    filteredData = filteredData.filter(cat => cat.profitPotential >= 20000 && cat.profitPotential <= 50000);
                    break;
                case 'low':
                    filteredData = filteredData.filter(cat => cat.profitPotential < 20000);
                    break;
                case 'top5':
                    filteredData = filteredData.slice(0, 5);
                    break;
            }
            
            let html = '';
            filteredData.forEach((cat, index) => {
                const actualRank = profitRankingData.indexOf(cat) + 1;
                let marginClass = 'good';
                if (cat.avgMargin < 15) marginClass = 'critical';
                else if (cat.avgMargin < 25) marginClass = 'low';
                
                html += `
                    <div class="profit-category-card" onclick="openCategoryAgent('${cat.category}')">
                        <div class="profit-rank">${actualRank}</div>
                        <div class="profit-category-name">${cat.category}</div>
                        <div class="profit-potential">€${cat.profitPotential.toLocaleString()}</div>
                        <div class="profit-details">
                            <div>💰 Yatırım: €${cat.totalInvestment?.toLocaleString() || 'N/A'}</div>
                            <div>📦 ${cat.totalStock} stok</div>
                            <div class="${marginClass}">📊 Marj: ${cat.avgMargin.toFixed(1)}%</div>
                        </div>
                    </div>
                `;
            });
            
            grid.innerHTML = html;
        }
        
        function filterByProfitLevel(level) {
            // Buton aktiflik durumunu güncelle
            document.querySelectorAll('.filter-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            currentProfitFilter = level;
            updateProfitRankingGrid();
        }
        
        function openCategoryAgent(category) {
            // Category-specific agent sayfasını aç
            const agentUrl = `category-agent.html?category=${encodeURIComponent(category)}`;
            window.open(agentUrl, '_blank');
        }
        
        function updateAllAgents() {
            console.log('🤖 Updating all agents from main dashboard...');
            
            // Filtered data'yı hazırla
            const filteredCategories = profitRankingData
                .filter(cat => {
                    switch(currentProfitFilter) {
                        case 'high': return cat.profitPotential > 50000;
                        case 'medium': return cat.profitPotential >= 20000 && cat.profitPotential <= 50000;
                        case 'low': return cat.profitPotential < 20000;
                        case 'top5': return profitRankingData.indexOf(cat) < 5;
                        default: return true;
                    }
                })
                .map(cat => cat.category);
            
            // localStorage'a kaydet
            const agentUpdateData = {
                timestamp: new Date().toISOString(),
                filter: currentProfitFilter,
                filteredCategories: filteredCategories,
                profitRanking: profitRankingData.slice(0, 10), // Top 10
                source: 'main-dashboard',
                updateType: 'manual_trigger'
            };
            
            localStorage.setItem('agentUpdateData', JSON.stringify(agentUpdateData));
            localStorage.setItem('lastAgentUpdate', Date.now().toString());
            
            // Visual feedback
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = '✅ Agentlar Güncellendi!';
            button.style.background = 'linear-gradient(135deg, #32CD32, #228B22)';
            
            // Agentlara notification gönder
            sendAgentNotifications(filteredCategories.length);
            
            setTimeout(() => {
                button.textContent = originalText;
                button.style.background = '';
            }, 3000);
            
            console.log('✅ Agent güncelleme verisi hazırlandı:', agentUpdateData);
        }
        
        function sendAgentNotifications(categoryCount) {
            // Sales & Campaign Agent'a bildirim
            showNotification(
                '🎯 Sales Agent Updated', 
                `${categoryCount} categories analyzed. New recommendations available.`,
                'high',
                () => window.open('sales-campaign-agent.html', '_blank')
            );
            
            // Profit Optimization Agent'a bildirim
            setTimeout(() => {
                showNotification(
                    '💰 Profit Agent Updated',
                    `Margin analysis refreshed for ${categoryCount} categories.`,
                    'medium',
                    () => window.open('profit-optimization-agent.html', '_blank')
                );
            }, 1000);
        }
        
        function showNotification(title, message, priority, onClick) {
            const notification = document.createElement('div');
            notification.className = 'recommendation-notification';
            notification.onclick = onClick;
            
            notification.innerHTML = `
                <div class="notification-header">
                    <div class="priority-${priority}">${priority.toUpperCase()}</div>
                    <div class="source">Main Dashboard</div>
                </div>
                <div class="notification-title">${title}</div>
                <div class="notification-message">${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }
        
        // Auto-check for updates
        setInterval(() => {
            loadProfitFilterData();
        }, 30000); // Check every 30 seconds
        
        // Margin Analysis Modal Functions
        let currentMarginData = null;
        
        function openMarginAnalysisTab() {
            loadProfitFilterData(); // Ensure data is loaded
            updateMarginAnalysisData();
            document.getElementById('marginAnalysisModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        function closeMarginAnalysisModal() {
            document.getElementById('marginAnalysisModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function switchMarginTab(event, tabName) {
            // Remove active class from all tabs
            document.querySelectorAll('.margin-tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.margin-tab-panel').forEach(panel => panel.style.display = 'none');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            document.getElementById(`margin${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab`).style.display = 'block';
            
            // Load tab-specific content
            switch(tabName) {
                case 'overview':
                    loadOverviewTab();
                    break;
                case 'categories':
                    loadCategoriesTab();
                    break;
                case 'products':
                    loadProductsTab();
                    break;
                case 'optimization':
                    loadOptimizationTab();
                    break;
            }
        }
        
        function updateMarginAnalysisData() {
            if (profitRankingData.length === 0) return;
            
            currentMarginData = {
                totalProfit: profitRankingData.reduce((sum, cat) => sum + cat.profitPotential, 0),
                avgMargin: profitRankingData.reduce((sum, cat) => sum + cat.avgMargin, 0) / profitRankingData.length,
                totalCategories: profitRankingData.length,
                opportunities: profitRankingData.filter(cat => cat.avgMargin < 30).length
            };
            
            // Update summary values
            document.getElementById('totalProfitPotentialModal').textContent = `€${currentMarginData.totalProfit.toLocaleString()}`;
            document.getElementById('avgMarginRateModal').textContent = `${currentMarginData.avgMargin.toFixed(1)}%`;
            document.getElementById('totalCategoriesModal').textContent = currentMarginData.totalCategories;
            document.getElementById('optimizationOpportunitiesModal').textContent = currentMarginData.opportunities;
        }
        
        function loadOverviewTab() {
            if (!currentMarginData) return;
            
            const container = document.getElementById('urgentRecommendations');
            let html = '';
            
            // Critical categories (low margin)
            const criticalCategories = profitRankingData.filter(cat => cat.avgMargin < 20);
            if (criticalCategories.length > 0) {
                criticalCategories.forEach(cat => {
                    html += `
                        <div class="recommendation-item critical">
                            <h4 style="margin-bottom: 10px;">🚨 Kritik: ${cat.category}</h4>
                            <p>Marj oranı sadece ${cat.avgMargin.toFixed(1)}%. Acilen fiyat artışı veya maliyet azaltma gerekli.</p>
                            <div style="margin-top: 10px;">
                                <strong>Önerilen Aksiyon:</strong> %${(25 - cat.avgMargin).toFixed(1)} fiyat artışı
                            </div>
                        </div>
                    `;
                });
            }
            
            // High potential categories
            const highPotentialCategories = profitRankingData.filter(cat => cat.profitPotential > 50000 && cat.avgMargin > 25);
            if (highPotentialCategories.length > 0) {
                html += `
                    <div class="recommendation-item success">
                        <h4 style="margin-bottom: 10px;">🎯 Yüksek Potansiyel</h4>
                        <p>Bu kategoriler yüksek kar potansiyeli ve iyi marjlara sahip: ${highPotentialCategories.map(c => c.category).join(', ')}</p>
                        <div style="margin-top: 10px;">
                            <strong>Önerilen Aksiyon:</strong> Stok artırımı ve agresif pazarlama
                        </div>
                    </div>
                `;
            }
            
            // Pricing opportunities
            const pricingOpportunities = profitRankingData.filter(cat => cat.avgMargin > 20 && cat.avgMargin < 30);
            if (pricingOpportunities.length > 0) {
                html += `
                    <div class="recommendation-item warning">
                        <h4 style="margin-bottom: 10px;">💲 Fiyat Optimizasyonu</h4>
                        <p>${pricingOpportunities.length} kategori fiyat artışı için uygun: ${pricingOpportunities.map(c => c.category).join(', ')}</p>
                        <div style="margin-top: 10px;">
                            <strong>Önerilen Aksiyon:</strong> %5-10 fiyat artışı testi
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        function loadCategoriesTab() {
            const container = document.getElementById('categoryMarginGrid');
            let html = '';
            
            profitRankingData.forEach(cat => {
                let marginClass = 'margin-excellent';
                let marginText = 'Mükemmel';
                
                if (cat.avgMargin < 20) {
                    marginClass = 'margin-critical';
                    marginText = 'Kritik';
                } else if (cat.avgMargin < 25) {
                    marginClass = 'margin-warning';
                    marginText = 'Dikkat';
                } else if (cat.avgMargin < 30) {
                    marginClass = 'margin-good';
                    marginText = 'İyi';
                }
                
                const landedCost = cat.totalInvestment ? cat.totalInvestment / cat.totalStock : 0;
                const sellingPrice = landedCost * (1 + cat.avgMargin / 100);
                
                html += `
                    <div class="margin-category-card">
                        <div class="margin-category-header">
                            <div class="margin-category-name">${cat.category}</div>
                            <div class="margin-percentage ${marginClass}">${cat.avgMargin.toFixed(1)}%</div>
                        </div>
                        
                        <div class="margin-metrics-grid">
                            <div class="margin-metric-box">
                                <div class="margin-metric-value">€${cat.profitPotential.toLocaleString()}</div>
                                <div class="margin-metric-label">Kar Potansiyeli</div>
                            </div>
                            <div class="margin-metric-box">
                                <div class="margin-metric-value">${cat.totalStock}</div>
                                <div class="margin-metric-label">Toplam Stok</div>
                            </div>
                            <div class="margin-metric-box">
                                <div class="margin-metric-value">€${landedCost.toFixed(0)}</div>
                                <div class="margin-metric-label">Ortalama Maliyet</div>
                            </div>
                            <div class="margin-metric-box">
                                <div class="margin-metric-value">€${sellingPrice.toFixed(0)}</div>
                                <div class="margin-metric-label">Satış Fiyatı</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px;">
                            <div style="font-weight: 600; margin-bottom: 5px;">Durum: ${marginText}</div>
                            <div style="font-size: 0.9em; opacity: 0.9;">
                                ${cat.avgMargin < 25 ? 'Optimizasyon gerekli - fiyat artışı önerilir' : 'Performans tatmin edici'}
                            </div>
                        </div>
                        
                        <div class="margin-actions">
                            <button class="margin-action-btn primary" onclick="optimizeCategoryMargin('${cat.category}')">🎯 Optimize Et</button>
                            <button class="margin-action-btn" onclick="analyzeCategoryDetails('${cat.category}')">📊 Detay</button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function loadProductsTab() {
            const container = document.getElementById('productMarginGrid');
            let html = '<div style="text-align: center; padding: 40px; opacity: 0.8;">📦 Ürün bazlı analiz için real-bicycle-dashboard.html kullanın</div>';
            container.innerHTML = html;
        }
        
        function loadOptimizationTab() {
            const container = document.getElementById('optimizationStrategies');
            
            let html = `
                <div class="recommendation-item success">
                    <h4>💡 Fiyatlandırma Stratejisi</h4>
                    <p>Elastisite analizi yaparak optimal fiyat noktalarını belirleyin. A/B testleri ile müşteri tepkisini ölçün.</p>
                    <button class="margin-action-btn primary" onclick="window.open('sales-campaign-agent.html', '_blank')">🎯 Satış Agentı</button>
                </div>
                
                <div class="recommendation-item warning">
                    <h4>📦 Stok Optimizasyonu</h4>
                    <p>Yüksek marjlı ürünlerde stok artırın, düşük marjlı ürünlerde stok azaltın. Tedarikçi görüşmeleri yapın.</p>
                    <button class="margin-action-btn primary" onclick="window.open('profit-optimization-agent.html', '_blank')">💰 Kar Agentı</button>
                </div>
                
                <div class="recommendation-item critical">
                    <h4>🎯 Kategori Yönetimi</h4>
                    <p>Düşük performanslı kategorileri gözden geçirin. Cross-selling ve bundle stratejileri uygulayın.</p>
                    <button class="margin-action-btn primary" onclick="window.open('real-bicycle-dashboard.html', '_blank')">📊 Analiz Dashboard</button>
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        function optimizeCategoryMargin(category) {
            console.log(`🎯 Optimizing margin for ${category}`);
            alert(`${category} kategorisi için optimizasyon stratejisi başlatıldı. Profit optimization agent açılıyor...`);
            window.open('profit-optimization-agent.html', '_blank');
        }
        
        function analyzeCategoryDetails(category) {
            console.log(`📊 Analyzing details for ${category}`);
            window.open(`real-bicycle-dashboard.html?category=${encodeURIComponent(category)}`, '_blank');
        }
        
        // Welcome message
        setTimeout(() => {
            console.log('🚴‍♂️ Trek Sales Hub - Multi-layered Dashboard System');
            console.log('📊 8 Core Modules | 🔗 5+ API Integrations | 🛠️ Development Tools');
            initializeTaxSchema(); // Initialize tax calculation schema
            loadProfitFilterData(); // Load profit data on startup
        }, 1000);
    </script>
</body>
</html>