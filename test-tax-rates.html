<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tax Rate Test</title>
</head>
<body>
    <h1>Tax Rate Test</h1>
    <div id="results"></div>

    <script>
        // Import the exact same tax schema
        let categoryMappings = {
            "dsw-bisiklet": {
                "name": "DSW Bƒ∞Sƒ∞KLET",
                "categories": [
                    "FX",
                    "DS",
                    "MARLIN"
                ],
                "taxRate": 70
            },
            "nci-bisiklet": {
                "name": "NCI Bƒ∞Sƒ∞KLET",
                "categories": [
                    "MADONE",
                    "EMONDA",
                    "DOMANE",
                    "POWERFLY",
                    "PROCALIBER",
                    "CHECKPOINT",
                    "SPEED CONCEPT",
                    "RAIL",
                    "DOMANE+",
                    "SUPERCALIBER",
                    "VERVE+",
                    "FUEL EXE",
                    "MARLƒ∞N+",
                    "FX+",
                    "KADRO",
                    "TOWNIE GO!",
                    "DS+",
                    "TOP FUEL"
                ],
                "taxRate": 35
            },
            "dsw-aksesuar": {
                "name": "DSW AKSESUAR",
                "categories": [
                    "VERVE",
                    "AYDINLATMA",
                    "√áANTA",
                    "ƒ∞√á LASTƒ∞K",
                    "Gƒ∞DON BOƒûAZI",
                    "BAGAJ-SEPET",
                    "MATARA-KAFES",
                    "ELCƒ∞K-Gƒ∞DON BANDI",
                    "KADRO KULAƒûI",
                    "PEDAL",
                    "POMPA",
                    "Zƒ∞L",
                    "Kƒ∞Lƒ∞T",
                    "KASK",
                    "ELDƒ∞VEN",
                    "DI≈û LASTƒ∞K",
                    "SELE-SELE BORUSU",
                    "ERKEK AYAKKABI",
                    "Tanƒ±msƒ±z",
                    "√áAMURLUK",
                    "ANAHTAR TAKIMI",
                    "PARK AYAƒûI",
                    "YEDEK PAR√áA",
                    "ELECTRA KADIN Bƒ∞Sƒ∞KLET"
                ],
                "taxRate": 60
            },
            "nci-aksesuar": {
                "name": "NCI AKSESUAR",
                "categories": [
                    "JANT SETƒ∞",
                    "Gƒ∞DON"
                ],
                "taxRate": 40
            },
            "gobik": {
                "name": "Gobik",
                "categories": [
                    "FORMA",
                    "√áORAP",
                    "TAYT-≈ûORT"
                ],
                "taxRate": 33
            },
            "trieye": {
                "name": "TriEye",
                "categories": [
                    "G√∂zl√ºk"
                ],
                "taxRate": 68
            },
            "bryton": {
                "name": "Bryton",
                "categories": [
                    "KM SAATƒ∞"
                ],
                "taxRate": 65
            },
            "saris": {
                "name": "Saris",
                "categories": [
                    "ARA√á ARKASI TA≈ûIYICI"
                ],
                "taxRate": 65
            }
        };

        // Same getTaxRate function
        function getTaxRate(product) {
            console.log(`üîç Tax rate detection for: ${product.title} (Category: ${product.category})`);
            
            if (categoryMappings && product.category) {
                const productCategory = product.category.toLowerCase();
                console.log(`üîç Checking category mappings for: "${productCategory}"`);
                console.log('Available mappings:', Object.keys(categoryMappings));
                
                for (const [upperCat, mapping] of Object.entries(categoryMappings)) {
                    console.log(`Checking ${upperCat}:`, mapping.categories);
                    if (mapping.categories) {
                        const categoryMatch = mapping.categories.some(cat => {
                            const catLower = cat.toLowerCase();
                            const match = productCategory.includes(catLower) || catLower.includes(productCategory);
                            if (match) {
                                console.log(`üìã Match found: "${productCategory}" ‚Üî "${catLower}"`);
                            }
                            return match;
                        });
                        
                        if (categoryMatch) {
                            console.log(`‚úÖ Category mapped: ${product.category} ‚Üí ${mapping.name} (${mapping.taxRate}% vergi)`);
                            return mapping.taxRate || 20;
                        }
                    }
                }
                
                console.log(`‚ùå No category mapping found for: ${product.category}`);
            } else {
                console.log(`‚ö†Ô∏è categoryMappings y√ºklenmemi≈ü veya √ºr√ºn kategorisi yok`);
            }
            
            console.log(`‚ö†Ô∏è Varsayƒ±lan vergi oranƒ± (%20) kullanƒ±lƒ±yor: ${product.title}`);
            return 20;
        }

        // Test cases
        const testProducts = [
            { title: "MADONE SL 7 2024", category: "MADONE" },
            { title: "FX 1 STAGGER 2024", category: "FX" },
            { title: "DS 3 2024", category: "DS" },
            { title: "EMONDA ALR 5 2024", category: "EMONDA" },
            { title: "VERVE 2 DISC 2024", category: "VERVE" },
            { title: "KASK POLƒ∞S", category: "KASK" },
            { title: "Unknown Product", category: "UNKNOWN" }
        ];

        let resultsHTML = '<h2>Test Results:</h2>';
        
        testProducts.forEach(product => {
            const taxRate = getTaxRate(product);
            const landedCost = 1000 + (1000 * taxRate / 100);
            
            resultsHTML += `
                <div style="border: 1px solid #ccc; margin: 10px; padding: 10px;">
                    <h3>${product.title}</h3>
                    <p><strong>Category:</strong> ${product.category}</p>
                    <p><strong>Tax Rate:</strong> ${taxRate}%</p>
                    <p><strong>Landed Cost (1000‚Ç¨ base):</strong> ${landedCost}‚Ç¨</p>
                </div>
            `;
        });

        document.getElementById('results').innerHTML = resultsHTML;

        console.log('üéØ Expected Results:');
        console.log('MADONE should be 35%');
        console.log('FX should be 70%');
        console.log('DS should be 70%');
        console.log('EMONDA should be 35%');
        console.log('VERVE should be 60%');
        console.log('KASK should be 60%');
        console.log('UNKNOWN should be 20%');
    </script>
</body>
</html>